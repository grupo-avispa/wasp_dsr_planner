<?xml version="1.0" encoding="UTF-8"?>
<root BTCPP_format="4"
      main_tree_to_execute="BehaviorTree">
  <BehaviorTree ID="BehaviorTree">
    <SubTree ID="Llm"/>
  </BehaviorTree>

  <BehaviorTree ID="Llm">
    <Sequence>
      <Say text="Hello, stand in front of me so I can see you."
           volume="50.0"
           executor_name="robot"/>
      <Delay delay_msec="2000">
        <IfThenElse>
          <PersonFound filter_case=""
                       node_id="{person_id}"
                       person_name="{person_name}"
                       pose="{person_pose}"
                       safe_distance="{person_distance}"
                       volume="{person_volume}"
                       executor_name="robot"/>
          <Sequence>
            <Interaction node_id="{person_id}"
                          executor_name="robot"/>
            <Say text="Thank you! Now tell me, what do you need?"
                 volume="50.0"
                 executor_name="robot"/>
          </Sequence>
          <Say text="I&apos;m sorry, I haven&apos;t been able to identify you. Please identify yourself when you tell me what you need."
               volume="50.0"
               executor_name="robot"/>
        </IfThenElse>
      </Delay>
      <Listen text="{query}"
              executor_name="robot"/>
      <LlmInvoke query="{query}"
                 person_name="{person_name}"
                 response="{response}"
                 executor_name="robot"/>
      <Say text="{response}"
           volume="50.0"
           executor_name="robot"/>
    </Sequence>
  </BehaviorTree>

  <!-- Description of Node Models (used by Groot) -->
  <TreeNodesModel>
    <Action ID="Interaction">
      <input_port name="node_id"
                  type="unsigned long">Node id of the person found</input_port>
    </Action>
    <Action ID="Listen">
      <output_port name="text">Text listened</output_port>
      <input_port name="executor_name">Executor node</input_port>
    </Action>
    <Action ID="LlmInvoke"
            editable="true">
      <input_port name="query">User query</input_port>
      <input_port name="person_name"
                  default="unknown">Name of the person to address in the LLM query (Optional)</input_port>
      <output_port name="response">LLM response</output_port>
    </Action>
    <Condition ID="PersonFound">
      <input_port name="filter_case">Value to filter the person found (Optional)</input_port>
      <output_port name="person_name">Name of the person found</output_port>
      <output_port name="node_id">Node Identifier of the person found</output_port>
      <output_port name="pose">Pose of the person found</output_port>
      <output_port name="safe_distance">Safe distance near the person to approach</output_port>
      <output_port name="volume">Volume level to say the text</output_port>
      <input_port name="executor_name">Executor node</input_port>
    </Condition>
    <Action ID="Say">
      <input_port name="text">Text to say</input_port>
      <input_port name="volume"
                  default="50.0">Volume level to say the text</input_port>
      <input_port name="executor_name">Executor node</input_port>
    </Action>
  </TreeNodesModel>

</root>
